<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>My Pixel Art Collection</title>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@hackernoon/pixel-icon-library@1.0.5/fonts/iconfont.min.css"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <style>
      body {
        font-family: "Courier New", monospace;
        background-color: #fdf6e3;
      }
      .pixel-btn {
        border: 3px solid black;
        background: #ffd700;
        padding: 6px 12px;
        font-weight: bold;
        box-shadow: 2px 2px 0 black;
      }
      .card {
        border: 3px solid black;
        background-color: white;
        box-shadow: 2px 2px 0 black;
      }
      .dropdown {
        position: relative;
        display: inline-block;
      }
      .dropdown-content {
        display: none;
        position: absolute;
        right: 0;
        background-color: white;
        min-width: 200px;
        border: 3px solid black;
        box-shadow: 2px 2px 0 black;
        z-index: 1;
      }
      .dropdown-content a {
        padding: 12px 16px;
        text-decoration: none;
        display: block;
        border-bottom: 2px solid black;
      }
      .dropdown-content a:last-child {
        border-bottom: none;
      }
      .dropdown:hover .dropdown-content {
        display: block;
      }
      .user-icon {
        width: 32px;
        height: 32px;
        border: 2px solid black;
        border-radius: 50%;
        cursor: pointer;
      }

      /* Custom Alert Modal */
      #custom-alert {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background-color: rgba(0, 0, 0, 0.5); /* Overlay */
        z-index: 1000;
        justify-content: center;
        align-items: center;
      }

      #custom-alert .card {
        background-color: white;
        border: 3px solid black;
        box-shadow: 2px 2px 0 black;
      }

      .pixel-btn {
        border: 3px solid black;
        background: #ffd700;
        padding: 6px 12px;
        font-weight: bold;
        box-shadow: 2px 2px 0 black;
        cursor: pointer;
      }

      .pixel-btn:hover {
        background-color: #e0b000;
      }

      #close-alert {
        background-color: #ff6347; /* Close button in tomato color */
      }
    </style>
  </head>
  <body class="p-6">
    <!-- Navbar -->
    <header class="max-w-4xl mx-auto">
      <nav class="bg-white p-2 card">
        <div class="flex justify-center items-center">
          <div class="flex justify-between items-center w-full max-w-4xl px-4">
            <a
              href="#"
              class="text-black text-xl font-bold border-r-2 border-black pr-4"
              >RetroPixel</a
            >
            <div class="space-x-6">
              <a href="/index.html" class="text-black hover:text-yellow-500"
                >Explore</a
              >
              <a href="/artists.html" class="text-black hover:text-yellow-500"
                >Artists</a
              >
              <a href="/uploadart.html" class="text-black hover:text-yellow-500"
                >Upload</a
              >
              <div class="dropdown inline-block">
                <i
                  class="hn hn-user-solid text-2xl cursor-pointer"
                  style="color: #ffd700"
                ></i>
                <div class="dropdown-content">
                  <a
                    href="/mycollections.html"
                    class="text-black hover:text-yellow-500"
                    >My Art Collection</a
                  >
                  <a
                    href="/uploadart.html"
                    class="text-black hover:text-yellow-500"
                    >Upload New Pixel Art</a
                  >
                  <a
                    href="/editprofile.html"
                    class="text-black hover:text-yellow-500"
                    >Edit Profile</a
                  >
                  <a
                  href="/order-details.html"
                  class="text-black hover:text-yellow-500"
                  >Order Details</a
                >
                  <a href="/auth.html" class="text-black hover:text-yellow-500"
                    >Logout</a
                  >
                </div>
              </div>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <!-- Main Container with max width and centered -->
    <div class="max-w-4xl mx-auto">
      <!-- Header -->
      <header class="text-center card mb-8 mt-8 p-4">
        <h1 class="text-3xl font-bold">üñºÔ∏è My Pixel Collection</h1>
        <p class="text-lg">Your saved retro masterpieces in one place.</p>
      </header>

      <!-- Collection Grid -->
      <div
        id="user-collection"
        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
      ></div>
      <header class="text-center card mb-8 mt-8 p-4">
        <h1 class="text-3xl font-bold">üõí My Cart Collection</h1>
        <p class="text-lg">Review your selected items before checkout.</p>
      </header>
      <div
        id="cart-items"
        class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6"
      ></div>

      <!-- Cart Total -->
      <div class="card p-4 text-center mt-6">
        <h3 id="total" class="font-bold">Total: $0.00</h3>
        <p id="item-count" class="text-sm">Items in Cart: 0</p>
      </div>
      <button id="proceed-btn" class="pixel-btn mt-4" onclick="checkout()">
        Proceed to Checkout
      </button>
    </div>

    <audio id="successSound" src="/audio/success.wav"></audio>

    <audio id="click-sound" src="/audio/click1.wav"></audio>

    <!-- Custom Alert Modal -->
    <div
      id="custom-alert"
      class="fixed inset-0 flex items-center justify-center bg-black bg-opacity-50 z-50 hidden"
    >
      <div class="card p-6 max-w-md w-full text-center">
        <h3 class="text-xl font-bold mb-4">Alert Title</h3>
        <p id="alert-message" class="text-gray-700 mb-4">
          This is your custom alert message!
        </p>
        <button id="close-alert" class="pixel-btn w-full">Close</button>
      </div>
    </div>


    <script>
      // Function to show the alert
      function showAlert(message = "Default message", title = "Alert") {
        const alertModal = document.getElementById("custom-alert");
        const alertMessage = document.getElementById("alert-message");
        const alertTitle = document.querySelector("#custom-alert h3");

        alertMessage.textContent = message;
        alertTitle.textContent = title;
        alertModal.style.display = "flex"; // Change from removing 'hidden' to setting display
        alertModal.classList.remove("hidden");
      }

      // Function to close the alert
      function closeAlert() {
        const alertModal = document.getElementById("custom-alert");
        alertModal.style.display = "none";
        alertModal.classList.add("hidden");
      }

      document.getElementById("close-alert").onclick = function () {
        closeAlert();
      };
      const successSound = document.getElementById("successSound");
      let userCreatedItems =
        JSON.parse(localStorage.getItem("myCollections")) || [];
      let cartItems = JSON.parse(localStorage.getItem("cart")) || [];
      const clickSound = document.getElementById("click-sound");

      function renderCollections() {
        const userContainer = document.getElementById("user-collection");
        const cartContainer = document.getElementById("cart-items");

        // Clear the current content before re-rendering
        userContainer.innerHTML = "";
        cartContainer.innerHTML = "";

        // Render user created items
        userCreatedItems.forEach((item) => {
          userContainer.innerHTML += `
      <div class="card p-4">
        <h2 class="text-xl font-bold mb-2">${item.title}</h2>
        <img src="${item.image}" alt="${item.title}" class="w-full h-40 object-contain mb-2" />
        <p class="text-sm mb-2">${item.description}</p>
        <div class="flex justify-between items-center">
          <span class="text-sm">Created by You</span>
          <button class="pixel-btn" onclick="removeFromBoth('${item.title}')">Remove</button>
        </div>
      </div>
    `;
        });

        // Render cart items
        cartItems.forEach((item) => {
          const price = parseFloat(item.price.replace("$", ""));
          cartContainer.innerHTML += `
      <div class="card p-4">
        <h2 class="text-xl font-bold mb-2">${item.title}</h2>
        <img src="${item.image}" alt="${item.title}" class="w-full h-40 object-contain mb-2" />
        <p class="text-sm mb-2">${item.description}</p>
        <p class="text-sm font-bold mb-2">${item.price}</p>
        <button class="pixel-btn" onclick="removeFromBoth('${item.title}')">Remove</button>
      </div>
    `;
        });

        // Update Total
        let total = cartItems.reduce(
          (sum, item) => sum + parseFloat(item.price.replace("$", "")),
          0
        );
        document.getElementById(
          "item-count"
        ).textContent = `Items in Cart: ${cartItems.length}`;
        document.getElementById("total").textContent = `Total: $${total.toFixed(
          2
        )}`;

        // Handle Proceed Button
        document.getElementById("proceed-btn").disabled =
          cartItems.length === 0;
      }

      // Function to remove an item by matching the title from both collection and cart
      function removeFromBoth(title) {
        // Remove from the collection by title
        userCreatedItems = userCreatedItems.filter(
          (item) => item.title !== title
        );
        localStorage.setItem("myCollections", JSON.stringify(userCreatedItems));

        // Remove from the cart by title
        cartItems = cartItems.filter((item) => item.title !== title);
        localStorage.setItem("cart", JSON.stringify(cartItems));

        // Re-render the collections and cart
        renderCollections();
      }

      renderCollections();

      // Helper function to play sound with error handling
      function playSound(audioElement) {
        if (audioElement) {
          audioElement.currentTime = 0;
          audioElement.play().catch((error) => {
            console.log("Error playing sound:", error);
          });
        }
      }

      // Update the click sound event listeners
      document.querySelectorAll("button").forEach((button) => {
        button.addEventListener("click", () => {
          playSound(clickSound);
        });
      });

      function checkout() {
        // Check if the cart has items
        if (cartItems.length === 0) {
          showAlert("Your cart is empty. Add items before checking out.");
          return;
        }

        // Calculate total price of items in the cart
        let totalAmount = cartItems.reduce(
          (sum, item) => sum + parseFloat(item.price.replace("$", "")),
          0
        );

        // Here, we would normally integrate a payment gateway
        // For simplicity, we simulate a successful checkout
        const isPaymentSuccessful = true; // Simulated successful payment

        if (isPaymentSuccessful) {
          // Add items to order details in localStorage
          const orderDetails = {
            items: cartItems,
            totalAmount: totalAmount.toFixed(2),
            date: new Date().toLocaleString(), // Adding a timestamp for the order
          };
          const existingOrders =
            JSON.parse(localStorage.getItem("order_details")) || [];
          existingOrders.push(orderDetails);
          localStorage.setItem("order_details", JSON.stringify(existingOrders));

          // Clear the cart after successful checkout
          localStorage.removeItem("cart");
          cartItems.length = 0;

          playSound(successSound); // Use the new helper function

          // Provide feedback to the user
          showAlert(`Checkout successful! Total: $${totalAmount.toFixed(2)}`);

          // Optionally, redirect to a confirmation page or order details
          window.location.href = "/order-details.html";
        } else {
          showAlert("There was an issue with your payment. Please try again.");
        }
      }
    </script>
  </body>
</html>
